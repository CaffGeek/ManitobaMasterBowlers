<mat-card class="mbam-table-surface">
  <mat-card-header>
    <div class="lane-draw-header">
      <h1>Lane Draw</h1>
      <div class="lane-draw-controls">
        <mat-form-field appearance="fill" class="lane-count-field">
          <mat-label>Number of lanes</mat-label>
          <input matInput type="number" min="1" max="99" step="1" [(ngModel)]="laneCount" />
        </mat-form-field>
      </div>
    </div>
  </mat-card-header>
  <mat-card-content>
    <section class="lane-draw-not-playing" *ngIf="notPlaying.length">
      <h2>Not Playing</h2>
      <ol>
        <li *ngFor="let bowler of notPlaying">
          <div class="lane-bowler lane-bowler--not-playing">
            <a
              class="lane-bowler__name"
              [routerLink]="['/bowlers', bowler.BowlerId]"
              target="_blank"
              rel="noopener"
              [title]="bowler.Name"
            >{{ bowler.Name }}</a>
            <span class="lane-bowler__average">
              <span *ngIf="getMastersAverage(bowler) !== null"
                class="lane-bowler__masters">{{ getMastersAverage(bowler) }}</span>
            </span>
            <span class="lane-bowler__actions">
              <app-action-icon-button
                class="lane-bowler__add"
                [icon]="faUserPlus"
                variant="neutral"
                [hideBorder]="true"
                ariaLabel="Move back to lanes"
                title="Move back to lanes"
                (action)="moveToLane(bowler)"
              ></app-action-icon-button>
            </span>
          </div>
        </li>
      </ol>
    </section>
    <div class="lane-draw-actions">
      <mat-form-field appearance="fill" class="lane-draw-search">
        <mat-label>Add bowler to draw</mat-label>
        <input
          matInput
          type="text"
          [(ngModel)]="bowlerSearch"
          (input)="updateFilteredBowlerOptions()"
          [matAutocomplete]="bowlerAuto"
        />
        <mat-autocomplete #bowlerAuto="matAutocomplete" (optionSelected)="selectBowler($event.option.value)">
          <mat-option *ngFor="let bowler of filteredBowlerOptions" [value]="bowler">
            {{ bowler.Name }}
          </mat-option>
        </mat-autocomplete>
      </mat-form-field>
      <button mat-raised-button color="primary" type="button" (click)="addSelectedBowler()" [disabled]="!selectedBowler">
        Add to draw
      </button>
      <button mat-stroked-button color="primary" type="button" (click)="rebalanceLanes()" [disabled]="!lanes.length">
        Rebalance
      </button>
    </div>
    <div class="lane-draw-grid">
      <section class="lane-draw-lane" *ngFor="let lane of lanes">
        <h2>Lane {{ lane.lane }}</h2>
        <ol>
          <li *ngFor="let bowler of lane.bowlers">
            <div class="lane-bowler">
            <a
              class="lane-bowler__name"
              [routerLink]="['/bowlers', bowler.BowlerId]"
              target="_blank"
              rel="noopener"
              [title]="bowler.Name"
            >{{ bowler.Name }}</a>
              <span class="lane-bowler__average">
                <!-- TODO: CHAD: Fix this hardcoded 10 -->
                <app-action-icon-button
                  *ngIf="bowler.events < 10"
                  class="lane-bowler__icon"
                  [class.warn]="getLeagueAverage(bowler) === null"
                  [class.info]="getLeagueAverage(bowler) !== null"
                  [icon]="getLeagueAverage(bowler) === null ? faExclamationTriangle : faInfoCircle"
                  [hideBorder]="true"
                  ariaLabel="Enter league average"
                  title="Enter league average"
                  (action)="promptLeagueAverage(bowler)"
                ></app-action-icon-button>
                <span *ngIf="getMastersAverage(bowler) !== null"
                  class="lane-bowler__masters">{{ getMastersAverage(bowler) }}</span>
              </span>
              <span class="lane-bowler__actions">
                <app-action-icon-button
                  class="lane-bowler__remove"
                  [icon]="faSquareMinus"
                  variant="delete"
                  [hideBorder]="true"
                  ariaLabel="Move to Not Playing"
                  title="Move to Not Playing"
                  (action)="moveToNotPlaying(bowler, lane)"
                ></app-action-icon-button>
              </span>
            </div>
          </li>
        </ol>
      </section>
    </div>
  </mat-card-content>
</mat-card>
